(()=>{"use strict";var e={777:function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.authenticateToken=t.generateAccessToken=void 0;const s=i(n(344)),u=(0,n(645).readConfig)();t.generateAccessToken=function(e){return s.sign({data:e},u.tokenSecret,{expiresIn:"7d"})},t.authenticateToken=function(e,t,n){const r=e.headers.authorization;if(r){const o=r.split(" ")[1];null===o&&t.status(401),s.verify(o,u.tokenSecret,((r,o)=>{if(r)return t.status(403);e.user=o,n()}))}}},843:function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),o(n(777),t)},558:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.userModel=void 0;const o=r(n(185)),i=new o.default.Schema({uuid:{required:!0,type:String},email:{required:!0,type:String},username:{required:!0,type:String},password:{required:!0,type:String}});t.userModel=o.default.model("user",i)},554:function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),o(n(558),t)},797:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.API=void 0;const o=r(n(860)),i=r(n(23)),s=r(n(986)),u=r(n(470)),a=r(n(582)),c=n(570),l=n(645),f=n(843);t.API=class{constructor(e){this.app=e||(0,o.default)(),this.config=(0,l.readConfig)()}createRoute(e,t,n){const r=o.default.Router();Object.keys(n).forEach(((o,i)=>{var s,u;t&&(null===(s=r[o])||void 0===s||s.call(r,e,f.authenticateToken,n[i])),null===(u=r[o])||void 0===u||u.call(r,e,n[i])})),this.registerRoute(r)}registerRoute(e){return i.default.info("Registering Route."),this.app.use(this.config.basePath,e),this}registerRoutes(e){return e.forEach((e=>{this.registerRoute(e)})),this}registerDefaultPlugins(){return this.app.use(s.default.json()),this.app.use((0,u.default)("combined")),this.config.useCors&&this.app.use((0,a.default)()),this}registerPlugin(e){return i.default.log("Registering custom app plugin..."),this.app.use(e),this}listen(e){this.app.listen(this.config.port,this.config.host,(()=>{i.default.info(`API is listening on ${this.config.port}.`),(0,c.connectToDatabase)(this.config.connectionString).then((()=>{i.default.success("Successfully connected to the database."),e&&e()})).catch((t=>{i.default.error("Unable to connect to MongoDB Instance. Please check your internet connection"),e&&e(t)}))}))}}},308:function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),o(n(797),t)},747:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{a(r.next(e))}catch(e){i(e)}}function u(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,u)}a((r=r.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.fileRouter=void 0;const i=o(n(860)),s=o(n(738)),u=o(n(17));t.fileRouter=i.default.Router();const a=s.default.diskStorage({destination:(e,t,n)=>{n(null,u.default.join(__dirname,"../../files"))},filename:(e,t,n)=>{const r=Date.now()+"-"+Math.round(1e9*Math.random());n(null,t.fieldname+"-"+r)}}),c=(0,s.default)({storage:a});t.fileRouter.post("/file/test",c.single("file"),((e,t)=>r(void 0,void 0,void 0,(function*(){t.status(200).json({message:"File uploaded success."})}))))},386:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{a(r.next(e))}catch(e){i(e)}}function u(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,u)}a((r=r.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.testRouter=void 0;const i=o(n(860));t.testRouter=i.default.Router(),t.testRouter.post("/posttest",((e,t)=>r(void 0,void 0,void 0,(function*(){t.status(200).json({message:"Post test was a success."})})))),t.testRouter.get("/gettest",((e,t)=>r(void 0,void 0,void 0,(function*(){t.status(200).json(e.body)}))))},826:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{a(r.next(e))}catch(e){i(e)}}function u(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,u)}a((r=r.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.userRouter=void 0;const i=o(n(860)),s=n(554),u=n(828),a=o(n(96)),c=n(843),l=n(645);t.userRouter=i.default.Router();const f=(0,l.readConfig)();t.userRouter.post("/register",((e,t)=>r(void 0,void 0,void 0,(function*(){var n;(e.body.name.length>70||e.body.email.length>70)&&t.status(400).json({message:"Character limit must be 70 or less"});const r=yield a.default.hash(e.body.password,f.passwordSalt),o=new s.userModel({uuid:null!==(n=e.body.uuid)&&void 0!==n?n:(0,u.v4)(),name:e.body.name,email:e.body.email,password:r});try{yield o.save();const e=(0,c.generateAccessToken)(o.uuid);t.status(200).json(e)}catch(e){t.status(400).json({message:e.message})}})))),t.userRouter.post("/login",((e,t)=>r(void 0,void 0,void 0,(function*(){const n=e.body.email,r=e.body.password,o=yield s.userModel.findOne({email:n});if(o)if(yield a.default.compare(r,o.password)){const e=(0,c.generateAccessToken)(o.username);t.status(200).json(Object.assign({token:e},o))}else t.status(400).json({error:"Invalid Password"})}))))},479:function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),o(n(826),t),o(n(386),t),o(n(747),t)},645:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.readConfig=void 0;const o=r(n(771));t.readConfig=function(){return{host:o.default.get("server.host"),port:o.default.get("server.port"),useCors:o.default.get("api.useCors"),basePath:o.default.get("api.basePath"),connectionString:o.default.get("api.connectionString"),tokenSecret:o.default.get("environment.tokenSecret"),passwordSalt:o.default.get("environment.passwordSalt")}}},570:function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.connectToDatabase=void 0;const s=i(n(185));t.connectToDatabase=function(e){return new Promise(((t,n)=>{s.connect(e).then(t).catch(n)}))}},96:e=>{e.exports=require("bcrypt")},986:e=>{e.exports=require("body-parser")},771:e=>{e.exports=require("config")},582:e=>{e.exports=require("cors")},860:e=>{e.exports=require("express")},344:e=>{e.exports=require("jsonwebtoken")},185:e=>{e.exports=require("mongoose")},470:e=>{e.exports=require("morgan")},738:e=>{e.exports=require("multer")},23:e=>{e.exports=require("node-color-log")},828:e=>{e.exports=require("uuid")},17:e=>{e.exports=require("path")}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r].call(i.exports,i,i.exports,n),i.exports}(()=>{const e=n(479);(new(n(308).API)).registerDefaultPlugins().registerRoutes([e.userRouter,e.testRouter,e.fileRouter]).listen((e=>{if(e)throw new Error(e)}))})()})();